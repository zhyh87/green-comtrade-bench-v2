{
    "$schema": "http://json-schema.org/draft-07/schema#",
    "$id": "https://green-comtrade-bench.example.com/schemas/metadata.schema.json",
    "title": "Purple Agent Metadata Schema",
    "description": "JSON Schema for metadata.json file in purple agent output (Evaluation Contract v1.0.0)",
    "type": "object",
    "required": [
        "task_id",
        "query",
        "row_count",
        "schema",
        "dedup_key"
    ],
    "properties": {
        "task_id": {
            "type": "string",
            "description": "Task identifier matching directory name",
            "pattern": "^T[1-7]_[a-z_]+$"
        },
        "query": {
            "type": "object",
            "description": "Query parameters used for the task",
            "required": [
                "reporter",
                "partner",
                "flow",
                "hs",
                "year"
            ],
            "properties": {
                "reporter": {
                    "type": "string",
                    "description": "ISO-3166 numeric country code"
                },
                "partner": {
                    "type": "string",
                    "description": "ISO-3166 numeric country code"
                },
                "flow": {
                    "type": "string",
                    "enum": [
                        "M",
                        "X"
                    ],
                    "description": "Trade flow: M (import) or X (export)"
                },
                "hs": {
                    "type": "string",
                    "pattern": "^[0-9]{2,6}$",
                    "description": "HS commodity code (2-6 digits)"
                },
                "year": {
                    "type": "integer",
                    "minimum": 2000,
                    "maximum": 2100,
                    "description": "Trade year"
                }
            },
            "additionalProperties": false
        },
        "row_count": {
            "type": "integer",
            "minimum": 0,
            "description": "Number of data rows in data.jsonl"
        },
        "schema": {
            "type": "array",
            "description": "List of field names in data",
            "minItems": 5,
            "items": {
                "type": "string"
            },
            "contains": {
                "enum": [
                    "year",
                    "reporter",
                    "partner",
                    "flow",
                    "hs",
                    "tradeValue",
                    "netWeight",
                    "qty",
                    "record_id"
                ]
            }
        },
        "dedup_key": {
            "type": "array",
            "description": "Primary key field names for deduplication",
            "minItems": 3,
            "items": {
                "type": "string"
            }
        },
        "created_at": {
            "type": "string",
            "format": "date-time",
            "description": "ISO-8601 timestamp of run completion"
        },
        "tool_versions": {
            "type": "object",
            "description": "Version info for tools used",
            "additionalProperties": {
                "type": "string"
            }
        },
        "request_stats": {
            "type": "object",
            "description": "HTTP request statistics",
            "properties": {
                "requests_total": {
                    "type": "integer",
                    "minimum": 0
                },
                "retries_total": {
                    "type": "integer",
                    "minimum": 0
                },
                "http_429": {
                    "type": "integer",
                    "minimum": 0
                },
                "http_500": {
                    "type": "integer",
                    "minimum": 0
                }
            }
        },
        "totals_handling": {
            "type": "object",
            "description": "Totals detection and handling info",
            "properties": {
                "enabled": {
                    "type": "boolean"
                },
                "rows_dropped": {
                    "type": "integer",
                    "minimum": 0
                }
            }
        },
        "notes": {
            "type": "string",
            "description": "Free-text notes"
        }
    },
    "additionalProperties": true
}